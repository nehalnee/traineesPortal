<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Trainees</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap');
    @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css');

    body {
      font-family: 'Open Sans', sans-serif;
      margin: 20px;
      background-color: #e0f7fa;
    }
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #ffffff;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      color: #007bb5;
      font-weight: 600;
      margin-bottom: 20px;
      font-size: 28px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #007bb5;
      padding: 12px;
      text-align: center;
      font-size: 18px;
    }
    th {
      background-color: #b3e5fc;
      color: #007bb5;
      font-weight: bold;
    }
    tr:nth-child(even) {
      background-color: #e1f5fe;
    }
    tr:hover {
      background-color: #b3e5fc;
    }
    img {
      width: 100px;
      height: auto;
    }
    .lang-switch {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 10px;
    }
    .lang-switch button {
      background-color: #007bb5;
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      padding: 10px;
      font-size: 16px;
      margin-left: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .lang-switch button i {
      margin-right: 5px;
    }
    .lang-switch button:hover {
      background-color: #005f86;
    }
    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .action-buttons button {
      padding: 10px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .edit-button {
      background-color: #007bb5;
      color: white;
    }
    .edit-button:hover {
      background-color: #005f86;
    }
    .delete-button {
      background-color: #dc3545;
      color: white;
    }
    .delete-button:hover {
      background-color: #a52834;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
      padding-top: 60px;
    }
    .modal-content {
      background-color: #ffffff;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #007bb5;
      width: 80%;
      max-width: 500px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .close {
      color: #007bb5;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
    .modal-input {
      width: 90%;
      padding: 10px;
      margin: 10px auto;
      display: block;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 18px;
    }
    .modal-button {
      padding: 10px 15px;
      margin: 10px 5px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }
    .save-button {
      background-color: #4CAF50;
      color: white;
    }
    .save-button:hover {
      background-color: #45a049;
    }
    .cancel-button {
      background-color: #ccc;
      color: white;
    }
    .cancel-button:hover {
      background-color: #999;
    }
    .success-dialog {
      background-color: #4CAF50;
      color: white;
      padding: 20px;
      border-radius: 8px;
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      z-index: 1000;
      display: none;
    }
    .rtl {
      direction: rtl;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="lang-switch">
      <button onclick="setLanguage('en')"><i class="fas fa-language"></i>English</button>
      <button onclick="setLanguage('ar')"><i class="fas fa-language"></i>العربية</button>
    </div>
    <h1 id="viewTitle">Trainees Information</h1>
    <button onclick="openSubmitModal()" style="background-color: #007bb5; color: white; border: none; border-radius: 50%; padding: 10px 20px; font-size: 16px; cursor: pointer;">+</button>
    <table id="traineesTable">
      <thead>
        <tr>
          <th id="nameHeader">Full Name</th>
          <th id="ageHeader">Age</th>
          <th id="genderHeader">Gender</th>
          <th id="placeOfBirthHeader">Place of Birth</th>
          <th id="affiliationNumberHeader">Affiliation Number</th>
          <th id="numberHeader">Contact Number</th>
          <th id="cardPicHeader">Card Picture</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Trainee data will be inserted here -->
      </tbody>
    </table>
  </div>

  <!-- Submit Modal -->
  <div id="submitModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('submitModal')">&times;</span>
      <h2 id="submitTitle">Submit New Trainee</h2>
      <form id="submitForm" enctype="multipart/form-data">
        <label for="fullName" id="submitNameLabel">Full Name:</label>
        <input type="text" id="submitFullName" class="modal-input" name="fullName" placeholder="Full Name">
        <label for="submitAge" id="submitAgeLabel">Age:</label>
        <input type="number" id="submitAge" class="modal-input" name="age" placeholder="Age" min="1" max="100">
        <label for="submitGender" id="submitGenderLabel">Gender:</label>
        <select id="submitGender" class="modal-input" name="gender">
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>
        <label for="submitPlaceOfBirth" id="submitPlaceOfBirthLabel">Place of Birth:</label>
        <input type="text" id="submitPlaceOfBirth" class="modal-input" name="placeOfBirth" placeholder="Place of Birth">
        <label for="submitAffiliationNumber" id="submitAffiliationNumberLabel">Affiliation Number:</label>
        <input type="text" id="submitAffiliationNumber" class="modal-input" name="affiliationNumber" placeholder="Affiliation Number">
        <label for="submitNumber" id="submitNumberLabel">Contact Number:</label>
        <input type="text" id="submitNumber" class="modal-input" name="number" placeholder="Contact Number" pattern="[0-9]{10}">
        <label for="submitCardPic" id="submitCardPicLabel">Card Picture:</label>
        <input type="file" id="submitCardPic" class="modal-input" name="cardPic" accept="image/*,.pdf">
        <button type="button" class="modal-button save-button" onclick="submitTrainee()">✔</button>
        <button type="button" class="modal-button cancel-button" onclick="closeModal('submitModal')">✖</button>
      </form>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('editModal')">&times;</span>
      <h2 id="editTitle">Edit Trainee</h2>
      <input type="hidden" id="editTraineeId">
      <label for="editFullName" id="editNameLabel">Full Name:</label>
      <input type="text" id="editFullName" class="modal-input" placeholder="Full Name">
      <label for="editAge" id="editAgeLabel">Age:</label>
      <input type="number" id="editAge" class="modal-input" placeholder="Age" min="1" max="100">
      <label for="editGender" id="editGenderLabel">Gender:</label>
      <select id="editGender" class="modal-input">
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <label for="editPlaceOfBirth" id="editPlaceOfBirthLabel">Place of Birth:</label>
      <input type="text" id="editPlaceOfBirth" class="modal-input" placeholder="Place of Birth">
      <label for="editAffiliationNumber" id="editAffiliationNumberLabel">Affiliation Number:</label>
      <input type="text" id="editAffiliationNumber" class="modal-input" placeholder="Affiliation Number">
      <label for="editNumber" id="editNumberLabel">Contact Number:</label>
      <input type="text" id="editNumber" class="modal-input" placeholder="Contact Number" pattern="[0-9]{10}">
      <button class="modal-button save-button" id="saveButton" onclick="saveTrainee()">✔</button>
      <button class="modal-button cancel-button" id="cancelButton" onclick="closeModal('editModal')">✖</button>
    </div>
  </div>

  <!-- Delete Modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('deleteModal')">&times;</span>
      <h2 id="deleteTitle">Are you sure you want to delete this trainee?</h2>
      <input type="hidden" id="deleteTraineeId">
      <button class="modal-button save-button" id="deleteButtonYes" onclick="confirmDeleteTrainee()">✔</button>
      <button class="modal-button cancel-button" id="deleteButtonNo" onclick="closeModal('deleteModal')">✖</button>
    </div>
  </div>

  <!-- Success Dialog -->
  <div id="successDialog" class="success-dialog">
    <span id="successMessage">Information submitted successfully!</span>
    <button onclick="closeSuccessDialog()">Close</button>
  </div>

  <script>
    const translations = {
      en: {
        viewTitle: 'Trainees Information',
        nameHeader: 'Full Name',
        ageHeader: 'Age',
        genderHeader: 'Gender',
        placeOfBirthHeader: 'Place of Birth',
        affiliationNumberHeader: 'Affiliation Number',
        numberHeader: 'Contact Number',
        cardPicHeader: 'Card Picture',
        submitTitle: 'Submit New Trainee',
        editTitle: 'Edit Trainee',
        deleteTitle: 'Are you sure you want to delete this trainee?',
        nameLabel: 'Full Name:',
        ageLabel: 'Age:',
        genderLabel: 'Gender:',
        placeOfBirthLabel: 'Place of Birth:',
        affiliationNumberLabel: 'Affiliation Number:',
        numberLabel: 'Contact Number:',
        submitCardPicLabel: 'Card Picture:',
        submitButton: 'Submit',
        cancelButton: 'Cancel',
        saveButton: 'Save',
        deleteButtonYes: 'Yes',
        deleteButtonNo: 'No',
        successMessage: 'Information submitted successfully!'
      },
      ar: {
        viewTitle: 'معلومات المتدربين',
        nameHeader: 'الاسم الكامل',
        ageHeader: 'العمر',
        genderHeader: 'الجنس',
        placeOfBirthHeader: 'مكان الولادة',
        affiliationNumberHeader: 'رقم الانتساب',
        numberHeader: 'رقم الاتصال',
        cardPicHeader: 'صورة البطاقة',
        submitTitle: 'تقديم متدرب جديد',
        editTitle: 'تعديل المتدرب',
        deleteTitle: 'هل أنت متأكد أنك تريد حذف هذا المتدرب؟',
        nameLabel: 'الاسم الكامل:',
        ageLabel: 'العمر:',
        genderLabel: 'الجنس:',
        placeOfBirthLabel: 'مكان الولادة:',
        affiliationNumberLabel: 'رقم الانتساب:',
        numberLabel: 'رقم الاتصال:',
        submitCardPicLabel: 'صورة البطاقة:',
        submitButton: 'تقديم',
        cancelButton: 'إلغاء',
        saveButton: 'حفظ',
        deleteButtonYes: 'نعم',
        deleteButtonNo: 'لا',
        successMessage: 'تم تقديم المعلومات بنجاح!'
      }
    };

    function setLanguage(lang) {
      const container = document.querySelector('.container');
      const successDialog = document.getElementById('successDialog');
      if (lang === 'ar') {
        container.classList.add('rtl');
        successDialog.classList.add('rtl');
      } else {
        container.classList.remove('rtl');
        successDialog.classList.remove('rtl');
      }

      document.getElementById('viewTitle').textContent = translations[lang].viewTitle;
      document.getElementById('nameHeader').textContent = translations[lang].nameHeader;
      document.getElementById('ageHeader').textContent = translations[lang].ageHeader;
      document.getElementById('genderHeader').textContent = translations[lang].genderHeader;
      document.getElementById('placeOfBirthHeader').textContent = translations[lang].placeOfBirthHeader;
      document.getElementById('affiliationNumberHeader').textContent = translations[lang].affiliationNumberHeader;
      document.getElementById('numberHeader').textContent = translations[lang].numberHeader;
      document.getElementById('cardPicHeader').textContent = translations[lang].cardPicHeader;

      document.querySelector('#submitModal h2').textContent = translations[lang].submitTitle;
      document.querySelector('#editModal h2').textContent = translations[lang].editTitle;
      document.querySelector('#deleteModal h2').textContent = translations[lang].deleteTitle;
      document.querySelector('label[for="submitFullName"]').textContent = translations[lang].nameLabel;
      document.querySelector('label[for="submitAge"]').textContent = translations[lang].ageLabel;
      document.querySelector('label[for="submitGender"]').textContent = translations[lang].genderLabel;
      document.querySelector('label[for="submitPlaceOfBirth"]').textContent = translations[lang].placeOfBirthLabel;
      document.querySelector('label[for="submitAffiliationNumber"]').textContent = translations[lang].affiliationNumberLabel;
      document.querySelector('label[for="submitNumber"]').textContent = translations[lang].numberLabel;
      document.querySelector('label[for="submitCardPic"]').textContent = translations[lang].submitCardPicLabel;
      document.querySelector('label[for="editFullName"]').textContent = translations[lang].nameLabel;
      document.querySelector('label[for="editAge"]').textContent = translations[lang].ageLabel;
      document.querySelector('label[for="editGender"]').textContent = translations[lang].genderLabel;
      document.querySelector('label[for="editPlaceOfBirth"]').textContent = translations[lang].placeOfBirthLabel;
      document.querySelector('label[for="editAffiliationNumber"]').textContent = translations[lang].affiliationNumberLabel;
      document.querySelector('label[for="editNumber"]').textContent = translations[lang].numberLabel;
      document.getElementById('successMessage').textContent = translations[lang].successMessage;

      document.getElementById('submitFullName').placeholder = translations[lang].nameLabel.slice(0, -1);
      document.getElementById('submitAge').placeholder = translations[lang].ageLabel.slice(0, -1);
      document.getElementById('submitPlaceOfBirth').placeholder = translations[lang].placeOfBirthLabel.slice(0, -1);
      document.getElementById('submitAffiliationNumber').placeholder = translations[lang].affiliationNumberLabel.slice(0, -1);
      document.getElementById('submitNumber').placeholder = translations[lang].numberLabel.slice(0, -1);
      document.getElementById('editFullName').placeholder = translations[lang].nameLabel.slice(0, -1);
      document.getElementById('editAge').placeholder = translations[lang].ageLabel.slice(0, -1);
      document.getElementById('editPlaceOfBirth').placeholder = translations[lang].placeOfBirthLabel.slice(0, -1);
      document.getElementById('editAffiliationNumber').placeholder = translations[lang].affiliationNumberLabel.slice(0, -1);
      document.getElementById('editNumber').placeholder = translations[lang].numberLabel.slice(0, -1);

      document.querySelector('select#submitGender option[value="Male"]').textContent = lang === 'ar' ? 'ذكر' : 'Male';
      document.querySelector('select#submitGender option[value="Female"]').textContent = lang === 'ar' ? 'أنثى' : 'Female';
      document.querySelector('select#editGender option[value="Male"]').textContent = lang === 'ar' ? 'ذكر' : 'Male';
      document.querySelector('select#editGender option[value="Female"]').textContent = lang === 'ar' ? 'أنثى' : 'Female';
    }

    async function fetchTrainees() {
      const response = await fetch('/view');
      const trainees = await response.json();

      const tableBody = document.querySelector('#traineesTable tbody');
      tableBody.innerHTML = '';

      trainees.forEach(trainee => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${trainee.full_name}</td>
          <td>${trainee.age}</td>
          <td>${trainee.gender}</td>
          <td>${trainee.place_of_birth}</td>
          <td>${trainee.affiliation_number}</td>
          <td>${trainee.number}</td>
          <td><img src="${trainee.card_pic_url}" alt="Card Picture"></td>
          <td class="action-buttons">
            <button class="edit-button" onclick="openEditModal(${trainee.id}, '${trainee.full_name}', ${trainee.age}, '${trainee.gender}', '${trainee.place_of_birth}', '${trainee.affiliation_number}', '${trainee.number}')"><i class="fas fa-edit"></i></button>
            <button class="delete-button" onclick="openDeleteModal(${trainee.id})"><i class="fas fa-trash-alt"></i></button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    function openSubmitModal() {
      document.getElementById('submitModal').style.display = 'block';
    }

    function openEditModal(id, fullName, age, gender, placeOfBirth, affiliationNumber, number) {
      document.getElementById('editTraineeId').value = id;
      document.getElementById('editFullName').value = fullName;
      document.getElementById('editAge').value = age;
      document.getElementById('editGender').value = gender;
      document.getElementById('editPlaceOfBirth').value = placeOfBirth;
      document.getElementById('editAffiliationNumber').value = affiliationNumber;
      document.getElementById('editNumber').value = number;
      document.getElementById('editModal').style.display = 'block';
    }

    function openDeleteModal(id) {
      document.getElementById('deleteTraineeId').value = id;
      document.getElementById('deleteModal').style.display = 'block';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    async function submitTrainee() {
      const form = document.getElementById('submitForm');
      const formData = new FormData(form);

      const response = await fetch('/api/trainees/submit', {
        method: 'POST',
        body: formData
      });

      if (response.ok) {
        fetchTrainees();
        closeModal('submitModal');
        showSuccessDialog();
      } else {
        alert('Failed to submit trainee information');
      }
    }

    async function saveTrainee() {
      const id = document.getElementById('editTraineeId').value;
      const fullName = document.getElementById('editFullName').value;
      const age = document.getElementById('editAge').value;
      const gender = document.getElementById('editGender').value;
      const placeOfBirth = document.getElementById('editPlaceOfBirth').value;
      const affiliationNumber = document.getElementById('editAffiliationNumber').value;
      const number = document.getElementById('editNumber').value;

      if (fullName && age && gender && placeOfBirth && affiliationNumber && number) {
        const response = await fetch(`/api/trainees/${id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            fullName,
            age,
            gender,
            placeOfBirth,
            affiliationNumber,
            number
          })
        });

        if (response.ok) {
          fetchTrainees();
          closeModal('editModal');
          showSuccessDialog();
        } else {
          alert('Failed to update trainee information');
        }
      } else {
        alert('All fields are required.');
      }
    }

    async function confirmDeleteTrainee() {
      const id = document.getElementById('deleteTraineeId').value;

      const response = await fetch(`/api/trainees/${id}`, {
        method: 'DELETE'
      });

      if (response.ok) {
        fetchTrainees();
        closeModal('deleteModal');
      } else {
        alert('Failed to delete trainee');
      }
    }

    function showSuccessDialog() {
      const dialog = document.getElementById('successDialog');
      dialog.style.display = 'block';
    }

    function closeSuccessDialog() {
      const dialog = document.getElementById('successDialog');
      dialog.style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', fetchTrainees);

    // Default language
    setLanguage('en');
  </script>
</body>
</html>

